# -------------------------------
# 1ï¸âƒ£ åˆ¤æ–·ä½œæ¥­ç³»çµ±ä¸¦åˆå§‹åŒ– Node
# -------------------------------
OS_TYPE="$(uname)"
echo "Detected OS: $OS_TYPE"

if [[ "$OS_TYPE" == MINGW* || "$OS_TYPE" == MSYS* || "$OS_TYPE" == CYGWIN* ]]; then
  # Windows ä½¿ç”¨ fnm
  echo "ğŸŸ¢ Initializing Node with fnm (Windows)"
  export PATH="$HOME/AppData/Local/fnm:$PATH"
  if command -v fnm >/dev/null 2>&1; then
    eval "$(fnm env)"
  else
    echo "âŒ fnm not found. Please install fnm."
    exit 1
  fi
else
  # macOS / Linux ä½¿ç”¨ nvm
  echo "ğŸŸ¢ Initializing Node with nvm (macOS/Linux)"
  if [ -s "$NVM_DIR/nvm.sh" ]; then
    # shellcheck disable=SC1090
    . "$NVM_DIR/nvm.sh"
  else
    echo "âŒ nvm not found. Please install nvm."
    exit 1
  fi
fi

# -------------------------------
# 2ï¸âƒ£ åˆ¤æ–·å¯ç”¨ package manager
# -------------------------------
if command -v pnpm >/dev/null 2>&1; then
    PM="pnpm"
elif command -v yarn >/dev/null 2>&1; then
    PM="yarn"
elif command -v npx >/dev/null 2>&1; then
    PM="npx"
else
    echo "âŒ æ²’æœ‰æ‰¾åˆ° pnpmã€yarn æˆ– npxï¼Œè«‹å…ˆå®‰è£ Node.js èˆ‡å…¶ä¸­ä¸€å€‹ package managerã€‚"
    exit 1
fi

echo "ğŸ›  Using $PM to run lint-staged"

# -------------------------------
# 3ï¸âƒ£ åŸ·è¡Œ lint-staged
# -------------------------------
case "$PM" in
    pnpm)
        pnpm exec lint-staged --config .lintstagedrc
        ;;
    yarn)
        yarn exec lint-staged --config .lintstagedrc
        ;;
    npx)
        npx lint-staged --config .lintstagedrc
        ;;
esac
